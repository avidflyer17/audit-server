<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Audit Serveur DW</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  crossorigin="anonymous"
  referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/scripts/viewer.js?v=1"></script>
  <style>
    :root {
      --bg: #191a24;
      --text: #f8f8f2;
      --heading: #8be9fd;
      --subheading: #50fa7b;
      --block-bg: #282a36;
    }
    .light-theme {
      --bg: #f0f0f0;
      --text: #1c1c1c;
      --heading: #007acc;
      --subheading: #2b8a3e;
      --block-bg: #ffffff;
    }
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: "Segoe UI", sans-serif;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
    }

    h1 {
      font-size: 2rem;
      color: var(--heading);
      margin-bottom: 0.5rem;
    }

    h2 {
      color: var(--subheading);
      margin-top: 2rem;
    }

    .subtitle {
      font-style: italic;
      margin-bottom: 1.5rem;
      color: #bbb;
    }

    select {
      background-color: #333;
      color: white;
      padding: 0.4rem;
      border-radius: 5px;
      border: none;
      margin-left: 0.5rem;
    }

    canvas {
      width: 100% !important;
      max-height: 300px;
    }

    .code-block {
      width: 100%;
      background-color: var(--block-bg);
      color: var(--text);
      padding: 1rem;
      border-radius: 5px;
      font-family: monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-x: auto;
      box-sizing: border-box;
      font-size: 1rem;
    }

    .block-wrapper {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #444;
      color: #fff;
      border: none;
      padding: 5px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: background 0.3s ease;
    }
    .copy-btn:hover {
      background: #666;
    }

    #themeSwitchWrapper {
      position: fixed;
      top: 1rem;
      right: 1rem;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 48px;
      height: 24px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #444;
      transition: .4s;
      border-radius: 24px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    .switch input:checked + .slider {
      background-color: #2196F3;
    }
    .switch input:checked + .slider:before {
      transform: translateX(24px);
    }

    @media screen and (max-width: 600px) {
      #themeSwitchWrapper {
        top: 0.5rem;
        right: 0.5rem;
      }
      .switch {
        width: 40px;
        height: 20px;
      }
      .slider:before {
        height: 14px;
        width: 14px;
      }
      .switch input:checked + .slider:before {
        transform: translateX(20px);
      }
    }

    .temp-wrapper {
      margin-top: 1rem;
      font-family: monospace;
      color: var(--text);
    }
    .temp-bar {
      width: 100%;
      max-width: 400px;
      height: 25px;
      background-color: #444;
      border-radius: 12px;
      overflow: hidden;
      margin: 0.5rem auto 0 auto;
    }
    .temp-fill {
      height: 100%;
      width: 0%;
      background-color: green;
      transition: width 0.5s ease, background-color 0.5s ease;
    }
    #tempValue {
      font-size: 1.2rem;
      font-weight: bold;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 8px;
      margin-left: 1rem;
      font-weight: bold;
      font-family: monospace;
    }
    .green  { background-color: #4caf50; color: white; }
    .orange { background-color: #ff9800; color: black; }
    .red    { background-color: #f44336; color: white; }

    .ip-container {
      font-family: monospace;
      background: var(--block-bg);
      padding: 0.5rem 1rem;
      border-radius: 5px;
      display: inline-block;
      margin-top: 0.5rem;
    }
    .ip-container div {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.2rem;
    }
    .ip-icon {
      font-size: 1.2rem;
    }

    .disk-bar-container {
      width: 100%;
      max-width: 600px;
      margin: auto;
    }
    .disk-bar {
      background: #444;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 4px;
    }
    .disk-bar-fill {
      height: 20px;
      text-align: center;
      font-size: 0.9rem;
      color: #fff;
    }

    .memory-container {
      max-width: 400px;
      margin: auto;
      padding: 1rem 0;
    }
    .port-group {
      position: relative;
      margin-bottom: 1rem;
      padding-left: 1rem;
      border-left: 3px solid #444;
    }

    .port-ip {
      font-weight: bold;
      color: var(--heading);
      margin-bottom: 0.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .port-entry {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 2px 0;
    }

    .port-entry i {
      color: #ffb86c;
    }

    .port-address {
      font-family: monospace;
      color: var(--text);
      word-break: break-word;      /* Permet de casser les longues IPv6 */
      overflow-wrap: anywhere;     /* Pour forcer le retour √† la ligne */
    }
    .protocol-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 1.2rem;
      color: var(--heading);
      margin-top: 1.5rem;
      margin-bottom: 0.4rem;
      border-bottom: 1px solid #444;
      padding-bottom: 0.3rem;
    }


    .protocol-header i {
      color: #ffb86c;
      font-size: 1.3rem;
    }

    .protocol-header .left {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .protocol-header .count {
      background: #444;
      border-radius: 6px;
      padding: 2px 8px;
      font-size: 0.9rem;
      font-family: monospace;
      color: #fff;
    }
    .copy-ip-btn {
      background: #444;
      border: none;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 0.8rem;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .copy-ip-btn:hover {
      background: #666;
    }

    @media screen and (max-width: 600px) {
      body {
        padding: 1rem;
      }
      h1 {
        font-size: 1.5rem;
      }
      h2 {
        font-size: 1.2rem;
        margin-top: 1.5rem;
      }
      .code-block {
        font-size: 0.9rem;
        padding: 0.75rem;
      }
    }
  </style>
</head>
<body>

  <div id="themeSwitchWrapper">
    <label class="switch">
      <input type="checkbox" id="themeToggle">
      <span class="slider"></span>
    </label>
  </div>

  <h1>üß† Audit Serveur DW</h1>
  <p class="subtitle">Machine : <strong id="hostname">-</strong></p>

  <label for="auditSelector">S√©lectionner un rapport :</label>
  <select id="auditSelector"></select>

  <h2>Date de g√©n√©ration</h2>
  <p id="generated">--</p>

  <h2>Adressage r√©seau</h2>
  <div id="ipInfo" class="ip-container">
    <div><span class="ip-icon">üì°</span> IP Locale : <span id="ipLocal">--</span></div>
    <div><span class="ip-icon">üåê</span> IP Externe : <span id="ipPublic">--</span></div>
  </div>

  <h2>Utilisation CPU par c≈ìur <span id="cpuLoadBadge" class="badge">--</span></h2>
  <canvas id="cpuChart"></canvas>

  <h2>Temp√©rature CPU</h2>
  <div class="temp-wrapper">
    <span id="tempValue">-- ¬∞C</span>
    <div class="temp-bar">
      <div id="tempFill" class="temp-fill"></div>
    </div>
  </div>

  <h2>M√©moire RAM</h2>
  <div class="memory-container">
    <canvas id="memoryChart"></canvas>
  </div>

  <h2>Disques</h2>
  <div id="disksContainer" class="disk-bar-container"></div>

  <h2>Services actifs</h2>
  <div class="block-wrapper">
    <button class="copy-btn" onclick="copyToClipboard('servicesText')">üìã</button>
    <pre id="servicesText" class="code-block"></pre>
  </div>

  <h2>Ports ouverts</h2>
  <div class="block-wrapper">
    <div id="portsText" class="code-block">
      <div class="protocol-header">
        <div class="left">
          <i class="fas fa-broadcast-tower"></i>
          <span>UDP</span>
        </div>
        <span class="count" id="udpCount">0</span>
      </div>
      <div id="udpPorts"></div>

      <div class="protocol-header">
        <div class="left">
          <i class="fas fa-network-wired"></i>
          <span>TCP</span>
        </div>
        <span class="count" id="tcpCount">0</span>
      </div>
      <div id="tcpPorts"></div>
    </div>
  </div>

  <h2>Top 5 processus - CPU</h2>
  <div class="block-wrapper">
    <button class="copy-btn" onclick="copyToClipboard('topCpuText')">üìã</button>
    <pre id="topCpuText" class="code-block"></pre>
  </div>

  <h2>Top 5 processus - RAM</h2>
  <div class="block-wrapper">
    <button class="copy-btn" onclick="copyToClipboard('topMemText')">üìã</button>
    <pre id="topMemText" class="code-block"></pre>
  </div>

  <h2>Conteneurs Docker</h2>
  <div class="block-wrapper">
    <button class="copy-btn" onclick="copyToClipboard('dockerText')">üìã</button>
    <pre id="dockerText" class="code-block"></pre>
  </div>

  <script>
    function copyToClipboard(id) {
      const text = document.getElementById(id).textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert("Copi√© dans le presse-papiers !");
      });
    }
  </script>
  <script>
    const themeSwitch = document.getElementById("themeToggle");
    function applyTheme(t){
      document.body.classList.toggle("light-theme", t === "light");
      themeSwitch.checked = t === "light";
    }
    themeSwitch.addEventListener("change", () => {
      const next = themeSwitch.checked ? "light" : "dark";
      localStorage.setItem("theme", next);
      applyTheme(next);
    });
    applyTheme(localStorage.getItem("theme") || "dark");
  </script>

</body>
</html>
